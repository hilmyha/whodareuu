---
import { getCollection } from "astro:content";
import BlogLayout from "@/layouts/blog-layout.astro";
import Section from "@/components/section.astro";
import { ArrowUpRight } from "lucide-react";

export async function getStaticPaths() {
  const categories = Array.from(
    new Set((await getCollection("posts")).map((post) => post.data.category))
  );
  return categories.map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const posts = (await getCollection("posts")).filter((post) =>
  post.data.category.includes(category)
);
---

<BlogLayout title={category}>
  <Section title={category} class="mt-14 px-3 py-12">
    {
      posts.map((post) => (
        <a
          href={`/blog/${post.data.slug}`}
          class="group flex items-start justify-between gap-3 p-3 border"
        >
          <div class="flex items-center gap-4">
            <div class="grid grid-cols-1">
              <p class="text-lg font-semibold group-hover:underline">
                {post.data.title}
              </p>
              <p class="text-sm text-muted-foreground">
                {post.data.date.toLocaleDateString(undefined, {
                  dateStyle: "full",
                  timeZone: "UTC",
                })}
              </p>
            </div>
          </div>
          <div class="w-5">
            <ArrowUpRight size={16} />
          </div>
        </a>
      ))
    }
  </Section>
</BlogLayout>
